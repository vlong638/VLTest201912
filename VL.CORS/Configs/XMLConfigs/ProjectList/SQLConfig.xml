<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Views>
	<View ViewName="">
		<Source SourceName="Data" DBSourceType="DefaultConnectionString">
			<Properties>
				<Property IsOn="true" ColumnName="*" Alias =""/>
			</Properties>
			<Wheres>
				<Where ComponentName="Name" Formatter="%@Name%"></Where>
				<Where ComponentName="DepartmentIds"/>
				<Where ComponentName="CreatedAtStart"/>
				<Where ComponentName="CreatedAtEnd"/>
			</Wheres>
			<SQLs> <!--UnitedBy="dizhibm"-->
				<SQL>
					select p.Id,p.Name,p.CreatorId,p.CreatedAt,p.LastModifiedAt
					,(select convert(nvarchar(50),pd.departmentId)+ ','
						from ProjectDepartment as pd
						where pd.projectId = p.id
						for xml path('')
					) as departmentIds
					from Project as p 
					left join ProjectDepartment as pd on pd.projectId = p.id
					where p.IsDeleted = 0
					<If Operator="NotEmpty" ComponentName="Name"> and p.name like @Name </If>
					<If Operator="NotEmpty" ComponentName="CreatedAtStart">and p.CreatedAt &gt;= @CreatedAtStart </If>
					<If Operator="NotEmpty" ComponentName="CreatedAtEnd"> and p.CreatedAt &lt; @CreatedAtEnd </If>
					<If Operator="NotEmpty" ComponentName="DepartmentIds"> and pd.DepartmentId in @DepartmentIds </If>
					group by p.Id,p.Name,p.CreatorId,p.CreatedAt,p.LastModifiedAt
					order by p.Id desc
					@Pager
				</SQL>
			</SQLs>
			<CountSQL>
				select count(*)
				from Project as p 
				left join ProjectDepartment as pd on pd.projectId = p.id
				where p.IsDeleted = 0
				<If Operator="NotEmpty" ComponentName="Name"> and p.name like @Name </If>
				<If Operator="NotEmpty" ComponentName="CreatedAtStart">and p.CreatedAt &gt;= @CreatedAtStart </If>
				<If Operator="NotEmpty" ComponentName="CreatedAtEnd"> and p.CreatedAt &lt; @CreatedAtEnd </If>
				<If Operator="NotEmpty" ComponentName="DepartmentIds"> and pd.DepartmentId in @DepartmentIds </If>
				group by p.Id,p.Name,p.CreatorId,p.CreatedAt,p.LastModifiedAt
			</CountSQL>
		</Source>
	</View>
</Views>
