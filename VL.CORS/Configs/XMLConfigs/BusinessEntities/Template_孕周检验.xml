<BusinessEntityTemplate Id="777202012230906" ConnectionString="FYPTConnectionString" TemplateName="检验结果分类周期模板">
	<BusinessEntity Id="20201222103157" DisplayName ="">
		<Properties>
			<!--From="CustomBusinessEntity.ReportName"--> 
			<Property Id="20201222103157001" DisplayName="检查名称" ColumnName="ExamName"/>
			<Property Id="20201222103157002" DisplayName="检查日期" ColumnName="ExamTime"/>
			<Property Id="20201222103157003" DisplayName="检验名称" ColumnName="ItemName"/>
			<Property Id="20201222103157004" DisplayName="检验结果" ColumnName="Value"/>
		</Properties>
	</BusinessEntity>
	<SQLConfig>
		<Wheres>
			<Where ComponentName="检查单类别" DisplayName="检查单类别" DisplayType="3" formatter="'%@检查单类别%'" Required="true"/>
			<Where ComponentName="检验类别" DisplayName="检验类别" DisplayType="3" Options="0148:葡萄糖,0193:血红蛋白" Required="true"/>
			<Where ComponentName="起始孕周" DisplayName="起始孕周" DisplayType="5"/>
			<Where ComponentName="截止孕周" DisplayName="截止孕周" DisplayType="5"/>
			<Where ComponentName="多值时取值方式" DisplayName="多值时取值方式" DisplayType="3" Options="0:最早,1:最晚,2:最小,3:最大,4:平均" Required="true"/>
			<Where ComponentName="检验结果小于" DisplayName="检验结果小于" DisplayType="1"/>
			<Where ComponentName="检验结果大于" DisplayName="检验结果大于" DisplayType="1"/>
		</Wheres>
		<SQL>
			select temp.idcard
			,lo.examname
			,lo.examtime
			,lr.itemname
			,lr.value
			from
			(
				select pi.idcard,pi.deliverydate
				<If Operator="eq" ComponentName="检查日期分组类别" Value="0"> ,min(lo.examtime) targetexamtime </If>
				<If Operator="eq" ComponentName="检查日期分组类别" Value="1"> ,max(lo.examtime) targetexamtime </If>
				from LabOrder lo
				left join LabResult lr on lo.Id = lr.orderid
				left join PregnantInfo pi on lo.idcard = pi.idcard
				where 1=1
				<If Operator="NotEmpty" ComponentName="检查单类别"> and lo.examcode like @检查单类别</If>
				<If Operator="NotEmpty" ComponentName="检验类别"> and lr.itemid = @检验类别</If>
				<If Operator="NotEmpty" ComponentName="起始孕周"> and lo.examtime &gt; @起始孕周 </If>
				<If Operator="NotEmpty" ComponentName="截止孕周"> and lo.examtime &lt; @截止孕周 </If>
				group by pi.idcard,pi.deliverydate
			) as temp
			left join LabOrder lo on temp.idcard = lo.idcard and temp.targetexamtime = lo.examtime
			left join LabResult lr on lo.Id = lr.orderid
			where 1 = 1
			<If Operator="NotEmpty" ComponentName="检验结果小于"> and lr.value &lt; @检验结果小于 </If>
			<If Operator="NotEmpty" ComponentName="检验结果大于"> and lr.value &gt; @检验结果大于 </If>
		</SQL>
	</SQLConfig>
	<Router From="PregnantInfo" FromAlias="pi" RouteType="LeftJoin">
		<!--ToAlias="ReportName"-->
		<On FromField="Idcard" ToField="Idcard"/>
	</Router>
</BusinessEntityTemplate>