<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Views>
	<View ViewName="">
		<Source SourceName="Data" DBSourceType="FYPTConnectionString">
			<Properties>
				<Property IsOn="true" ColumnName="*" Alias =""/>
			</Properties>
			<Wheres>
				<Where ComponentName="单位名称" Formatter="%@单位名称%"></Where>
				<Where ComponentName="日期范围Start"/>
				<Where ComponentName="日期范围End"/>
				<Where ComponentName="dataScope"></Where>
				<Where ComponentName="dizhibm"></Where>
				<Where ComponentName="organizationCode"></Where>
			</Wheres>
			<OrderBys>
				<!--<OrderBy ComponentName="fuwujgbh" Alias ="fuwujgbh"/>-->
			</OrderBys>
			<SQLs UnitedBy="fuwujgbh">
				<SQL>
					select jg.*
					,p1.*
					from (
						select
						gf.fuwujgbh,
						gz.mingcheng
						from GY_ZD_SHENGSHIQX_QC gz
						left join GY_FUWUJG gf on gz.DAIMA = gf.fuwujgbh
						where 1=1
						<If Operator="eq" ComponentName ="dataScope" Value="2" > and gf.dizhibm = @dizhibm </If>
						<If Operator="eq" ComponentName ="dataScope" Value="3" > and gf.fuwujgbh = @organization </If>
						order by gf.fuwujgbh asc
						@Pager
					) jg
					left join (
						select
						dr.visitunitcode fuwujgbh,
						count(*) huochanzs,
						sum(case when nr.babysex=1 then 1 else 0 end) huochannan,
						sum(case when nr.babysex=2 then 1 else 0 end) huochannv,
						sum(case when nr.babysex!=1 and nr.babysex!=2 then 1 else 0 end)huochanbm
						from cdh_newbornrecord nr
						left join cdh_deliveryrecord dr on nr.chanshibh = dr.chanshibh
						where nr.outcomeofbirth = 1
						<If Operator="NotEmpty" ComponentName="日期范围Start"> and dr.tianbiaosj &gt;= @日期范围Start </If>
						<If Operator="NotEmpty" ComponentName="日期范围End"> and dr.tianbiaosj &lt; dateadd(day,1,@日期范围End) </If>
						and dr.visitunitcode in
						(
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="eq" ComponentName ="dataScope" Value="2"> and dizhibm = @dizhibm </If>
							<If Operator="eq" ComponentName ="dataScope" Value="3"> and fuwujgbh = @organization </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by dr.visitunitcode
					) p1 on jg.fuwujgbh =  p1.fuwujgbh
				</SQL>
			</SQLs>
			<CountSQL>
				select
				count()*
				from GY_ZD_SHENGSHIQX_QC gz
				left join GY_FUWUJG gf on gz.DAIMA = gf.fuwujgbh
				where 1=1
				<If Operator="eq" ComponentName ="dataScope" Value="2" > and dizhibm = @dizhibm </If>
				<If Operator="eq" ComponentName ="dataScope" Value="3" > and fuwujgbh = @organization </If>
				<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
			</CountSQL>
		</Source>
	</View>
</Views>
