<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Exports>
	<!--注意 保留字  ColumnName="target"-->
	<Export ExportName="" FileName="列表.xlsx">
		<Sheet SheetName="列表">
			<Source SourceName="Data" DBSourceType="FYPTConnectionString">
				<Properties>
					<Property IsOn="true" ColumnName="*" Alias =""/>
				</Properties>
				<Wheres>
					<Where ComponentName="fuwujgmc" Formatter="%@fuwujgmc%"></Where>
					<Where ComponentName="登记日期Start"></Where>
					<Where ComponentName="登记日期End"></Where>
					<Where ComponentName="dizhibm"></Where>
					<Where ComponentName="机构编码"></Where>
				</Wheres>
				<OrderBys>
					<!-- <OrderBy ComponentName="id" Alias ="tb.序号"/> -->
				</OrderBys>
				<SQL>
					select 
						jg.fuwujgmc fuwujgmc,
						jg.fuwujgbh fuwujgbh, 
						huochan.*,
						baby.*,
						perinatal.*,
						pregnancy.*,
						baby.babys + yiner.wusuizs as wusuizs,
						baby.babys + yiner.yiners as yiners,
						baby.babynans + yiner.wusuizsnan as wusuizsnan,
						baby.babynans + yiner.yinersnan as yinersnan,
						baby.babynvs + yiner.wusuizsnv as wusuizsnv,
						baby.babynvs + yiner.yinersrnv as yinersrnv,
						baby.babybms + yiner.wusuizsbm as wusuizsbm,
						baby.babybms + yiner.yinersbm as yinersbm
					from (
						select fuwujgbh,fuwujgmc
						from GY_FUWUJG
						where 1=1
						<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
						<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
						<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
						order by fuwujgbh asc
						@Pager
					) jg
					left join (
						select
							subjg.fuwujgbh,
							count(*) huochanzs,
							sum(case when nr.babysex=1 then 1 else 0 end) huochannan,
							sum(case when nr.babysex=2 then 1 else 0 end) huochannv,
							sum(case when nr.babysex!=1 and nr.babysex!=2 then 1 else 0 end)huochanbm
						from cdh_newbornrecord nr
						left join cdh_deliveryrecord dr on nr.chanshibh = dr.chanshibh
						left join cdh_pregnantinfo pi on pi.chanshibh = dr.chanshibh
						left join GY_FUWUJG subjg on dr.visitunitcode = subjg.fuwujgbh
						where pi.realregioncode != pi.homeaddress
						and nr.outcomeofbirth = 1 and pi.ownerarea != 1
						<If Operator="NotEmpty" ComponentName="登记日期Start"> and CONVERT(varchar(100), dr.tianbiaosj, 23) &gt;= @登记日期Start </If>
						<If Operator="NotEmpty" ComponentName="登记日期End"> and CONVERT(varchar(100), dr.tianbiaosj, 23) &lt; dateadd(day,1,@登记日期End) </If>
						and subjg.fuwujgbh in (
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
							<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by subjg.fuwujgbh
					) huochan on jg.fuwujgbh = huochan.fuwujgbh
					left join (
						select 
							subjg.fuwujgbh,
							sum(case when DATEDIFF(Day,d.babybirth,d.deathdate)&gt;=0 and DATEDIFF(Day,d.babybirth,d.deathdate)&lt;=28 then 1 else 0 end) babys,
							sum(case when DATEDIFF(Day,d.babybirth,d.deathdate)&gt;=0 and DATEDIFF(Day,d.babybirth,d.deathdate)&lt;=28 AND d.babysex = '1' then 1 else 0 end) babynans,
							sum(case when DATEDIFF(Day,d.babybirth,d.deathdate)&gt;=0 and DATEDIFF(Day,d.babybirth,d.deathdate)&lt;=28 AND d.babysex = '2' then 1 else 0 end) babynvs,
							sum(case when DATEDIFF(Day,d.babybirth,d.deathdate)&gt;=0 and DATEDIFF(Day,d.babybirth,d.deathdate)&lt;=28 AND d.babysex &lt;&gt; '1' and d.babysex &lt;&gt; '2' then 1 else 0 end) babybms
						from perinataldeathcase d
						left join GY_FUWUJG subjg on d.entryunitcode = subjg.fuwujgbh
						where d.mobileflag = 1
						and d.status = 1
						<If Operator="NotEmpty" ComponentName="登记日期Start"> and CONVERT(varchar(100), d.entrydate, 23) &gt;= @登记日期Start </If>
						<If Operator="NotEmpty" ComponentName="登记日期End"> and CONVERT(varchar(100), d.entrydate, 23) &lt; dateadd(day,1,@登记日期End) </If>
						and subjg.fuwujgbh in(
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
							<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by subjg.fuwujgbh
					) baby on jg.fuwujgbh = baby.fuwujgbh
					left join (
						select
							subjg.fuwujgbh,
							sum(case when FLOOR(datediff(DY,d.birthday,d.deathdate)/365.25)&lt;1 then 1 else 0 end) yiners,
							sum(case when FLOOR(datediff(DY,d.birthday,d.deathdate)/365.25)&lt;1 and d.childsex='1' then 1 else 0 end) yinersnan,
							sum(case when FLOOR(datediff(DY,d.birthday,d.deathdate)/365.25)&lt;1 and d.childsex='2' then 1 else 0 end) yinersrnv,
							sum(case when FLOOR(datediff(DY,d.birthday,d.deathdate)/365.25)&lt;1 and d.childsex&lt;&gt;'2' and d.childsex&lt;&gt;'1' then 1 else 0 end) yinersbm,
							count(*) wusuizs,
							sum(case when d.childsex='1' then 1 else 0 end) wusuizsnan,
							sum(case when d.childsex='2' then 1 else 0 end) wusuizsnv,
							sum(case when d.childsex&lt;&gt;'2' and d.childsex&lt;&gt;'1' then 1 else 0 end) wusuizsbm,
							count(*) wusuisw
						from underfiveyearsdeathcase d
						left join GY_FUWUJG subjg on d.entryunitcode = subjg.fuwujgbh
						where d.mobileflag = 1
						and d.status = 1
						<If Operator="NotEmpty" ComponentName="登记日期Start"> and CONVERT(varchar(100), d.entrydate, 23) &gt;= @登记日期Start </If>
						<If Operator="NotEmpty" ComponentName="登记日期End"> and CONVERT(varchar(100), d.entrydate, 23) &lt; dateadd(day,1,@登记日期End) </If>
						and subjg.fuwujgbh in(
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
							<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by subjg.fuwujgbh
					) yiner on jg.fuwujgbh = yiner.fuwujgbh
					left join (
						select 
							subjg.fuwujgbh,
							sum(case when d.babyending = '2' or d.babyending = '3' or d.babyending = '4' then 1 else 0 end) perinatals,
							sum(case when d.babyending = '4' then 1 else 0 end) perinatalall,
							sum(case when d.babyending = '4' and d.babysex=1 then 1 else 0 end) perinatalnan,
							sum(case when d.babyending = '4' and d.babysex=2 then 1 else 0 end) perinatalnv,
							sum(case when d.babyending = '4' and d.babysex!=1 and d.babysex!=2 then 1 else 0 end) perinatalbm
						from perinataldeathcase d
						left join GY_FUWUJG subjg on d.entryunitcode = subjg.fuwujgbh
						where d.mobileflag = 1
						and d.status = 1
						<If Operator="NotEmpty" ComponentName="登记日期Start"> and CONVERT(varchar(100), d.entrydate, 23) &gt;= @登记日期Start </If>
						<If Operator="NotEmpty" ComponentName="登记日期End"> and CONVERT(varchar(100), d.entrydate, 23) &lt; dateadd(day,1,@登记日期End) </If>
						and subjg.fuwujgbh in(
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
							<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by subjg.fuwujgbh
					) perinatal on jg.fuwujgbh = perinatal.fuwujgbh
					left join (
						select
							subjg.fuwujgbh,
							count(*) pregnancydeathnum
						from pregnantdeathcase d
						left join GY_FUWUJG subjg on d.recordreportunitcode = subjg.fuwujgbh
						where d.status = 1
						<If Operator="NotEmpty" ComponentName="登记日期Start"> and CONVERT(varchar(100), d.recordreportdate, 23) &gt;= @登记日期Start </If>
						<If Operator="NotEmpty" ComponentName="登记日期End"> and CONVERT(varchar(100), d.recordreportdate, 23) &lt; dateadd(day,1,@登记日期End) </If>
						and subjg.fuwujgbh in(
							select fuwujgbh
							from GY_FUWUJG
							where 1=1
							<If Operator="NotEmpty" ComponentName ="dizhibm" Value="" > and dizhibm = @地区编码 </If>
							<If Operator="NotEmpty" ComponentName ="机构编码" Value="" > and fuwujgbh = @机构编码 </If>
							<If Operator="NotEmpty" ComponentName ="单位名称"> and fuwujgmc like @单位名称 </If>
							order by fuwujgbh asc
							@Pager
						)
						group by subjg.fuwujgbh
					) pregnancy on jg.fuwujgbh = pregnancy.fuwujgbh
					order by jg.fuwujgbh asc
				</SQL>
			</Source>
		</Sheet>
	</Export>
</Exports>