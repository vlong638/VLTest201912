<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Views>
	<View ViewName="">
		<Source SourceName="Data" DBSourceType="FYPTConnectionString">
			<Properties>
				<Property IsOn="true" ColumnName="*" Alias ="jg.fuwujgmc 单位名称
,hc.*
,info.* 
,za.*
"/>
			</Properties>
			<Wheres>
				<Where ComponentName="取卵日期Start">tb.取卵日期 &gt;= @取卵日期Start</Where>
				<Where ComponentName="取卵日期End">tb.取卵日期 &lt;= @取卵日期End</Where>
			</Wheres>
			<OrderBys>
				<OrderBy ComponentName="id" Alias ="tb.序号"/>
			</OrderBys>
			<SQL>
select @Properties
from (
	select fuwujgbh,fuwujgmc
	from GY_FUWUJG
	WHERE fuwujgjb != '6'
	order by fuwujgbh asc
	@Pager
) jg
left join (
	select
	g.manaunitid fuwujgbh,
	sum(case when (h.highrisktype like concat('%',01,'%') or h.highrisktype like concat('%',18,'%'))then 1 else 0 end) 早产	,
	sum(case when g.birthWeight&lt; '1500' then 1 else 0 end) 极低出生体重儿,
	sum(case when h.highrisktype like concat('%',02,'%')then 1 else 0 end) 足月小样儿,
	sum(case when h.highrisktype like concat('%',06,'%')then 1 else 0 end) HIE,
	sum(case when h.highrisktype like concat('%',07,'%')then 1 else 0 end) 颅内出血,
	sum(case when (h.highrisktype like concat('%',09,'%') or h.highrisktype like concat('%',10,'%'))then 1 else 0 end) 其他惊厥,
	sum(case when h.highrisktype like concat('%',04,'%')then 1 else 0 end) 呼吸系统RDS,
	sum(case when h.highrisktype like concat('%',03,'%')then 1 else 0 end) 高胆红素血症,
	sum(case when h.highrisktype like concat('%',17,'%')then 1 else 0 end) 其它,
	count(*) 本季总数,
	sum(case when h.endmanage = 1 then 1 else 0 end) 管理率
	from cc_highrisk h
	left join cc_generalinfo g on h.childid = g.childid
	where h.status = 1
	<If Operator="NotEmpty" ComponentName ="取卵日期Start"> and h.registerdate &gt;= @取卵日期Start </If>
	<If Operator="NotEmpty" ComponentName ="取卵日期End"> and h.registerdate &gt;= @取卵日期End </If>
	and g.manaunitid in
		(select fuwujgbh
		from GY_FUWUJG
		WHERE fuwujgjb != '6'
		order by fuwujgbh asc
		@Pager)
	group by g.manaunitid
) info on jg.fuwujgbh = info.fuwujgbh
left join (
	select
	dr.visitunitcode fuwujgbh,
	count(*) 活产数 
	from cdh_newbornrecord nr
	left join cdh_deliveryrecord dr on nr.chanshibh = dr.chanshibh
	where nr.outcomeofbirth = 1
	<If Operator="NotEmpty" ComponentName ="取卵日期Start"> and nr.tianbiaosj &gt;= @取卵日期Start </If>
	<If Operator="NotEmpty" ComponentName ="取卵日期End"> and nr.tianbiaosj &gt;= @取卵日期End </If>
	and dr.visitunitcode in
		(select fuwujgbh
		from GY_FUWUJG
		WHERE fuwujgjb != '6'
		order by fuwujgbh asc
		@Pager)
	group by dr.visitunitcode
) hc on jg.fuwujgbh = hc.fuwujgbh
left join (
	select
	g.manaunitid fuwujgbh,
	count(*) 应管人数,
	sum(case when h.endmanage = 1 then 1 else 0 end) 总管理人数	
	from cc_highrisk h
	left join cc_generalinfo g on h.childid = g.childid
	where h.status = 1
	<If Operator="NotEmpty" ComponentName ="取卵日期Start"> and h.registerdate &gt;= @取卵日期Start </If>
	<If Operator="NotEmpty" ComponentName ="取卵日期End"> and h.registerdate &gt;= @取卵日期End </If>
	and g.manaunitid in
		(select fuwujgbh
		from GY_FUWUJG
		WHERE fuwujgjb != '6'
		order by fuwujgbh asc
		offset 0 rows FETCH NEXT 15 ROWS ONLY)
	group by g.manaunitid
) za on jg.fuwujgbh = za.fuwujgbh
			</SQL>
			<CountSQL>
	select count(*)
	from GY_FUWUJG
	WHERE fuwujgjb != '6'
			</CountSQL>
		</Source>
	</View>
</Views>
