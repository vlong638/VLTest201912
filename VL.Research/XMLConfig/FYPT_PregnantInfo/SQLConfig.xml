<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Views>
	<View ViewName="User">
		<Properties>
			<Property IsOn="true" ColumnName="*" Alias ="row_number() over (@OrderBy) as rowindex
			,p.id
			,p.pregnantbookid
			,p.personname
			,p.age
			,p.idcard
			,p.realregioncode
			,hr.highrisklv
			,p.dateofprenatal
			,p.mobilenumber
			,p.createdate
			,p.gestationalweeks
			,p.husbandname
			,p.husbandmobile
			,p.realregion_text as realregiontext
			,p.sourceunit
			,p.manaunitid
			,p.status
			, p.createdate,hr.infectionflag
			,p.mobilenumber, p.createtime, p.pregnantid
			,(case when b.book_no is not null then 1 else 0 end) as mzscbindstatus"/>
		</Properties>
		<Wheres>
			<Where ComponentName="personname" Formatter="%@personname%">personname like @personname</Where>
			<Where ComponentName="idcard" Formatter="%@idcard%">idcard like @idcard</Where>
			<Where ComponentName="pregnantbookid">pregnantbookid = @pregnantbookid</Where>
			<Where ComponentName="istmp">istmp = @istmp</Where>
			<Where ComponentName="status">status = @status</Where>
			<!--<Where ComponentName="realregiontext" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="休养地址" DisplayType="1"/>-->
			<!--<Where ComponentName="id1" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="!建册机构" DisplayType="1"/>
			<Where ComponentName="id2" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="!管辖机构" DisplayType="1"/>
			<Where ComponentName="id3" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="!户籍地址" DisplayType="1"/>
			<Where ComponentName="id4" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="!居住地址" DisplayType="1"/>
			<Where ComponentName="id5" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="建档医生" DisplayType="1"/-->>
			<!--<Where ComponentName="createdate" CompareOperator="Like" Value="" LinkOperator="None" DisplayName="建档日期" DisplayType="5"/>-->

		</Wheres>
		<OrderBys>
			<OrderBy ComponentName="createdate" Alias ="p.createdate"/>
		</OrderBys>
		<SQL>
			select @Fields
			from pregnantinfo p
			left join (
			select distinct book_no from mzsc_bind_info where type = 'pregnant'
			) b on b.book_no = p.pregnantid
			left join gy_fuwujg gy on p.createunitcode = gy.fuwujgbh
			left join (
			select
			v.pregnantinfoid, max(v.highrisklevel) as highrisklv,max(v.infectionflag) as infectionflag
			from v_all_visitrecord v
			inner join(
			select
			a.pregnantinfoid as pregnantinfoid, max(a.visitdate) as visitdate
			from
			v_all_visitrecord a group by a.pregnantinfoid
			) b on b.pregnantinfoid = v.pregnantinfoid and b.visitdate = v.visitdate
			group by v.pregnantinfoid
			) hr on hr.pregnantinfoid = p.id
			@Wheres
			@OrderBy
			@Pager
		</SQL>
	</View>
</Views>