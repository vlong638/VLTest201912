<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<All>
	<CustomBusinessEntities>
		<CustomBusinessEntity DisplayName ="孕期最晚一次空腹血糖">
			<Properties>
				<Property DisplayName="身份证" ColumnName="Idcard"/>
				<Property DisplayName="空腹血糖" ColumnName="Value"/>
			</Properties>
			<Wheres>
				<Where ComponentName="检查类别" DisplayName="检查类别" DisplayType="3" Options="0:非流动孕产妇,1:流动孕产妇" Required="true"/>
				<Where ComponentName="检查日期天数" DisplayName="检查日期(多少天内)" DisplayType="2"/>
				<Where ComponentName="检查日期分组类型" DisplayName="检查日期分组类型" DisplayType="3" Options="0:max,1:min" Required="true"/>
				<!--"DisplayType <类型[1-文本框|2-数字框|3-单选下拉框|4-树状下拉框|5-日期选择框][默认:1]>",-->
			</Wheres>
			<SQL>
				select temp.idcard,lr.value 
				from
				(
					select pi.idcard,pi.deliverydate
					<If Operator="eq" ComponentName="检查日期分组类型" Value="0"> ,max(lo.examtime) targetexamtime </If>
					<If Operator="eq" ComponentName="检查日期分组类型" Value="1"> ,min(lo.examtime) targetexamtime </If>
					from LabOrder lo
					left join LabResult lr on lo.orderid = lr.orderid
					left join PregnantInfo pi on lo.idcard = pi.idcard
					where lr.itemid = '@检查类别'
					and pi.deliverydate &gt; lo.examtime
					<If Operator="NotEmpty" ComponentName="检查日期天数"> and pi.deliverydate &lt; dateadd(day,@检查日期天数,lo.examtime) </If>
					group by pi.idcard,pi.deliverydate
				) as temp
				left join LabOrder lo on temp.idcard = lo.idcard and temp.targetexamtime = lo.examtime
				left join LabResult lr on lo.orderid = lr.orderid
				where lr.itemid = '@检查类别' 
				and temp.deliverydate &gt; lo.examtime
				<If Operator="NotEmpty" ComponentName="检查日期天数"> and temp.deliverydate &lt; dateadd(day,@检查日期天数,lo.examtime) </If>
			</SQL>
			<Router From="PregnantInfo" To="this" RouteType="LeftJoin">
				<On FromAlias="pi" FromField="Idcard" ToAlias="yqzwyckfxt" ToField="Idcard"/>
			</Router>
		</CustomBusinessEntity>
	</CustomBusinessEntities>	
</All>
